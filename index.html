<!DOCTYPE html>
<html lang="es-MX" xml:lang="es-MX">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Metr√≥nomo">
  <meta name="image" content="https://sanxofon.github.io/metro/metro.jpg">
  <meta name="author" content="Santiago Ch√°vez Novaro">
  <!-- <link rel="manifest" href="https://sanxofon.github.io/metro/manifest.json"> -->
  <link rel="manifest" href="https://sanxofon.github.io/metro/manifest.webmanifest">
  <title>Metronomo</title>
  <meta name="theme-color" content="#222323" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Metr√≥nomo">
  <meta name="apple-mobile-web-app-title" content="Metr√≥nomo">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="og:title" content="Metr√≥nomo">
  <meta name="og:description" content="Metr√≥nomo irregular circular con sonidos reales, ligero y f√°cil de instalar en cualquier dispositivo desde el navegador.">
  <meta name="og:image" content="https://sanxofon.github.io/metro/metro.jpg">
  <meta name="og:url" content="https://sanxofon.github.io/metro/">
  <meta name="og:site_name" content="Sociedad Matem√°tica Mexicana">
  <meta name="og:locale" content="es_MX">
  <meta name="og:type" content="website">
  <meta name="website:author" content="Santiago Ch√°vez Novaro">
  <meta itemprop="name" content="Metr√≥nomo">
  <meta itemprop="description" content="Metr√≥nomo irregular circular con sonidos reales, ligero y f√°cil de instalar en cualquier dispositivo desde el navegador.">
  <meta itemprop="image" content="https://sanxofon.github.io/metro/metro.jpg">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Metr√≥nomo">
  <meta name="twitter:description" content="Metr√≥nomo irregular circular con sonidos reales, ligero y f√°cil de instalar en cualquier dispositivo desde el navegador.">
  <meta name="twitter:site" content="@grupolalengua">
  <meta name="twitter:creator" content="@sanxofon">
  <meta name="twitter:image:src" content="https://sanxofon.github.io/metro/metro.jpg">
  <meta name="format-detection" content="telephone=no">
  <link rel="icon" type="image/png" sizes="192x192" href="https://sanxofon.github.io/metro/icon-192x192.png">
  <link rel="apple-touch-icon" href="https://sanxofon.github.io/metro/icon-192x192.png">
  <link rel="shortcut icon" href="https://sanxofon.github.io/metro/favicon.png" type="image/png">
  <link rel="icon" href="https://sanxofon.github.io/metro/favicon.png" type="image/png">

  <link rel="stylesheet" href="metro.css">
  <link rel="stylesheet" href="teclado.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
</head>
<body>
<div class="metronome">

  <div id="readmeModal" class="readmodal">
    <div class="readmodal-content">
      <span class="close-button">√ó</span>
      <div id="readmeContent"></div>
    </div>
  </div>

  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <span class="close">√ó</span>
      <h2>&#128193; Patrones guardados</h2>
      <div id="memoria"><!--select id="memoria" name="memoria" size="8"></select--></div>
      <hr>
      <h2>‚è≥ Historial</h2>
      <div id="historial"><!--select id="historial" name="historial" size="6"></select--></div>
      <div><a href="#" id="vaciarHistorial">Vaciar historial de patrones</a></div>
    </div>
  </div>

  <div class="recuadro reloj">

    <!-- DARK/LIGHT MODE SWITCH -->
    <div class="switch-div">
      <label class="switch" title="Modo Oscuro/Claro">
        <input type="checkbox" id="darkModeSwitch">
        <span class="slider round"></span>
      </label>
    </div>
  
    <!-- SETTINGS -->
    <div class="settings-icon" title="Configuraci√≥n">
      &#9776; <!-- Gear icon entity -->
    </div>

    <!-- C√çRCULO -->
    <div class="clock">
      <div class="hand hour-hand"></div>
    </div>
    
    <!-- BOTONES -->
    <div>
      <button id="startButton">&#9658;</button>
      
      <div class="recuadro beat-counter">0</div>
      <button id="stopButton">&#9724;</button>
    </div>

    <!-- PATR√ìN -->
    <div class="recuadro">
      <div id="patternLen" title="Longitud del patr√≥n"></div>
      <div>
        <input type="text" id="beatPattern" value="">
        <!-- <input type="text" id="beatPattern" inputmode="none" value=""> -->
      </div>
    </div>

    <!-- RESULTADO -->
    <div id="resultado"></div>
    
    <br>

  </div>
  <!-- BOTONERA -->
  <div class="recuadro">
    <div class="botonera">
      <button id="teclado-switch" title="Muestra / Oculta el teclado">&#9000;</button>
      <button id="recorrer-left" title="Recorrer patr√≥n a la izquierda">&#8634;</button>
      <button id="recorrer-right" title="Recorrer patr√≥n a la derecha">&#8635;</button>
      <button id="abrir-patrones" title="Abrir patrones"><span class="invertfilterdark">&#128193;</span></button>
      <button id="guardar-patron" title="Guardar Patr√≥n"><span class="invertfilterdark">üíæ</span></button>
    </div>
  </div>

  <!-- TECLADO -->
  <div class="teclado" style="display: none;">
    <button class="boton number" title="Conga agudo (galleta)" onclick="playBeat(1);">A</button>
    <button class="boton number" title="Metal agudo (chapa)" onclick="playBeat(2);">B</button>
    <button class="boton number" title="Madera agudo (clave)" onclick="playBeat(3);">C</button>
    <button class="boton backspace" id="backspace" title="Borrar anterior">‚å´</button>
    <button class="boton number" title="Sonaja agudo (maraca)" onclick="playBeat(4);">D</button>
    <button class="boton number" title="Conga agudo (abierto)" onclick="playBeat(5);">E</button>
    <button class="boton number" title="Conga grave (tapado)" onclick="playBeat(6);">F</button>
    <button class="boton supr" id="supr" title="Borrar siguiente">‚å¶</button>
    <button class="boton number" title="Timbal grave (largo)" onclick="playBeat(7);">G</button>
    <button class="boton number" title="Tom de piso grave (corto)" onclick="playBeat(8);">H</button>
    <button class="boton number" title="Tom de piso grave (largo)" onclick="playBeat(9);">I</button>
    <button class="boton vaciar" id="vaciar" title="Borrar el patr√≥n">&#10006;</button>
    <button class="boton number" id="zero" title="Silencio">0</button>
    <button class="boton operator left" id="left" title="Mover cursor a la Izquierda">‚ûß</button>
    <button class="boton operator" id="right" title="Mover cursor a la Derecha">‚ûß</button>
  </div>


  <!-- HERRAMIENTAS -->
  <div class="recuadro">
    <div>
      <select title="Beats o Compases por minuto" id="BPM-CPM">
        <option value="0" title="Beats Por Minuto">BPM</option>
        <option value="1" title="Compases Por Minuto">CPM</option>
      </select>
      <input type="number" id="bpmInput" value="120" min="1" max="1440">
    </div>
    <div>
      <label for="volumen">Velocidad</label>
      <input type="range" id="bpmSlider" min="1" max="1440" value="120" class="vmiddle">
    </div>
    <div>
      <label for="volumen">Volumen</label>
      <input type="range" name="volumen" id="volumen" min="0" max="1" step="0.01" value="1" class="vmiddle">
    </div>
  </div>

  <!-- MUTEAR -->
  <div class="recuadro">
    <div>Silenciar golpes espec√≠ficos</div>
    <div class="numberContainer">
      <div class="grid" id="numberGrid" title="Silenciar / Desilenciar"><div id="mute-icon" title="Silenciar / Desilenciar todos">&#128263;</div></div>
    </div>
  </div>

  <hr>
  <h1>  
      Metr√≥nomo
  </h1>

  <p>
    Selecciona la velocidad de los <i>beats</i> (BPM) o de <i>comp√°s</i> (CPM) y escribe un patr√≥n r√≠tmico, puedes hacer <i>silencios</i> con <b class="mono">0</b> (cero) y usar <a href="javascript:playBeat(1);" class="mono">A</a>,
    <a href="javascript:playBeat(2);" class="mono">B</a>,
    <a href="javascript:playBeat(3);" class="mono">C</a>,
    <a href="javascript:playBeat(4);" class="mono">D</a>,
    <a href="javascript:playBeat(5);" class="mono">E</a>,
    <a href="javascript:playBeat(6);" class="mono">F</a>,
    <a href="javascript:playBeat(7);" class="mono">G</a>,
    <a href="javascript:playBeat(8);" class="mono">H</a>,
    <a href="javascript:playBeat(9);" class="mono">I</a> para los distintos <i>golpes</i>.
  </p>
  <div>
    <label for="presets">Aqu√≠ tienes algunos ritmos de ejemplo:</label>
    <select id="presets">
      <option value="" disabled selected>-- Selecciona un patr√≥n r√≠tmico --</option>
      <option value="C00C00CH00C0CBB0">Clave de Son (16)</option>
      <option value="C0C0BB0C0C0BB0B0">Samba (16)</option>
      <option value="A0C0C0A0C0C0">Vals (12)</option>
      <option value="AC0BICBC0B0C">Son jarocho (12)</option>
    </select>
  </div>
  <div>O bien</div>
  <div class="randomizador">
    <div><button type="button" id="randomForm">Generar Patr√≥n al azar</button></div>
    <br>
    <div>
      <label for="minLength">Min: <input type="number" id="minLength" value="8" min="1" max="256"></label>
      <label for="maxLength">M√°x: <input type="number" id="maxLength" value="32" min="1" max="256"></label>
    </div>
    <div>
      <input type="range" id="zeroProportion" value="0.3" step="0.01" min="0" max="0.99">
      <br>
      <label for="zeroProportion">Proporci√≥n de ceros :</label>
    </div>
  </div>

  <p class="small">
    Puedes <button type="button" id="showReadme">VER EL README</button> del proyecto para tener m√°s informaci√≥n.
  </p>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
<script src="https://cdn.rawgit.com/showdownjs/showdown/1.9.1/dist/showdown.min.js"></script>

<script src="beats.js"></script>
<script src="metro.js"></script>

<script>
// Carga la lista de ritmos presets
fetch('ritmos.json')
  .then(response => response.json())
  .then(data => {
    data.forEach(ritmo => {
      const option = document.createElement('option');
      option.value = ritmo.value;
      option.text = ritmo.text;
      if(ritmo.off>0) {
        option.setAttribute('disabled','disabled');
      }
      document.getElementById('presets').add(option);
    });
  })
  .catch(error => {
    console.error('Error fetching data:', error);
  });
</script>

<script>
// Fetch README.md and convert it to HTML
fetch('README.md') 
.then(response => response.text())
.then(markdown => {
  let converter = new showdown.Converter();
  let html = converter.makeHtml(markdown);
  document.getElementById('readmeContent').innerHTML = html;
});
// Modal functionality
let readmodal = document.getElementById("readmeModal");
let btn = document.getElementById("showReadme");
let span = document.getElementsByClassName("close-button")[0];
btn.onclick = function() {
  readmodal.style.display = "block";
}
span.onclick = function() {
  readmodal.style.display = "none";
}
window.onclick = function(event) {
  if (event.target == readmodal) {
    readmodal.style.display = "none";
  }
}
</script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js')
      .then(registration => {
        console.log('Service Worker registered:', registration);
        // Listen for updatefound event
        registration.addEventListener('updatefound', () => {
          const newWorker = registration.installing;

          newWorker.addEventListener('statechange', () => {
            if (newWorker.state === 'installed') {
              // Show update prompt
              if (confirm("Nueva versi√≥n disponible. ¬øActualizar ahora?")) {
                window.location.reload(); // Refresh for update
              }
            }
          });
        });
      })
      .catch(error => console.error('Service Worker registration failed:', error));
  });
}
</script>
</body>
</html>