<!DOCTYPE html>
<html lang="es-MX" xml:lang="es-MX">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Metrónomo">
  <meta name="image" content="https://sanxofon.github.io/metro/metro.jpg">
  <meta name="author" content="Santiago Chávez Novaro">
  <link rel="manifest" href="https://sanxofon.github.io/metro/manifest.json">
  <title>Metronomo</title>
  <meta name="theme-color" content="#222323" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Metrónomo">
  <meta name="apple-mobile-web-app-title" content="Metrónomo">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="og:title" content="Metrónomo">
  <meta name="og:description" content="Metrónomo irregular circular con sonidos reales, ligero y fácil de instalar en cualquier dispositivo desde el navegador.">
  <meta name="og:image" content="https://sanxofon.github.io/metro/metro.jpg">
  <meta name="og:url" content="https://sanxofon.github.io/metro/">
  <meta name="og:site_name" content="Sociedad Matemática Mexicana">
  <meta name="og:locale" content="es_MX">
  <meta name="og:type" content="website">
  <meta name="website:author" content="Santiago Chávez Novaro">
  <meta itemprop="name" content="Metrónomo">
  <meta itemprop="description" content="Metrónomo irregular circular con sonidos reales, ligero y fácil de instalar en cualquier dispositivo desde el navegador.">
  <meta itemprop="image" content="https://sanxofon.github.io/metro/metro.jpg">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Metrónomo">
  <meta name="twitter:description" content="Metrónomo irregular circular con sonidos reales, ligero y fácil de instalar en cualquier dispositivo desde el navegador.">
  <meta name="twitter:site" content="@grupolalengua">
  <meta name="twitter:creator" content="@sanxofon">
  <meta name="twitter:image:src" content="https://sanxofon.github.io/metro/metro.jpg">
  <meta name="format-detection" content="telephone=no">
  <link rel="icon" type="image/png" sizes="192x192" href="https://sanxofon.github.io/metro/icon-192x192.png">
  <link rel="apple-touch-icon" href="https://sanxofon.github.io/metro/icon-192x192.png">
  <link rel="shortcut icon" href="https://sanxofon.github.io/metro/favicon.png" type="image/png">
  <link rel="icon" href="https://sanxofon.github.io/metro/favicon.png" type="image/png">

  <link rel="stylesheet" href="metro.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
</head>
<body>
<div class="metronome">

  <div id="readmeModal" class="readmodal">
    <div class="readmodal-content">
      <span class="close-button">×</span>
      <div id="readmeContent"></div>
    </div>
  </div>

  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <span class="close">×</span>
      <h2>⏳ Historial</h2>
      <div><select id="historial" name="historial" size="8"></select></div>
      <div><a href="#" id="vaciarHistorial">Vaciar historial de patrones</a></div>
    </div>
  </div>

  <div class="recuadro reloj">

    <!-- DARK/LIGHT MODE SWITCH -->
    <div class="switch-div">
      <label class="switch" title="Modo Oscuro/Claro">
        <input type="checkbox" id="darkModeSwitch">
        <span class="slider round"></span>
      </label>
    </div>
  
    <!-- SETTINGS -->
    <div class="settings-icon" title="Configuración">
      ⏳ <!-- Gear icon entity -->
    </div>

    <!-- CÍRCULO -->
    <div class="clock">
      <div class="hand hour-hand"></div>
    </div>

    <!-- PATRÓN -->
    <div class="recuadro">
      <div id="patternLen" title="Longitud del patrón"></div>
      <div>
        <input type="text" id="beatPattern" placeholder="Ingrese un patrón rítmico (e.g., 1020)" value="">
      </div>
    </div>
    
    <!-- BOTONES -->
    <div>
      <button id="startButton">&#9658;</button>
      
      <div class="recuadro beat-counter">0</div>
      <button id="stopButton">&#9724;</button>
    </div>
    
    <br>

  </div>

  <!-- PATRÓN -->
  <div class="recuadro">
    <div class="numberContainer">
      <div class="grid" id="numberGrid" title="Silenciar / Desilenciar"><div id="mute-icon" title="Silenciar / Desilenciar todos">&#128263;</div></div>
    </div>
  </div>
  
  <!-- HERRAMIENTAS -->
  <div class="recuadro">
    <div>
      <select title="Beats o Compases por minuto" id="BPM-CPM">
        <option value="0" title="Beats Por Minuto">BPM</option>
        <option value="1" title="Compases Por Minuto">CPM</option>
      </select>
      <input type="number" id="bpmInput" value="120" min="1" max="1000">
    </div>
    <div>
      <label for="volumen">Velocidad</label>
      <input type="range" id="bpmSlider" min="1" max="1000" value="120" style="vertical-align: middle;">
    </div>
    <div>
      <label for="volumen">Volumen</label>
      <input type="range" name="volumen" id="volumen" min="0" max="1" step="0.01" value="1" style="vertical-align: middle;">
    </div>
  </div>

  <h1>  
      Metrónomo
  </h1>

  <p>
    Selecciona la velocidad de los <i>beats</i> (BPM) o de <i>compás</i> (CPM) y escribe un patrón rítmico, puedes hacer <i>silencios</i> con <b class="mono">0</b> (cero) y usar <a href="javascript:playBeat(1);" class="mono">A</a>,
    <a href="javascript:playBeat(2);" class="mono">B</a>,
    <a href="javascript:playBeat(3);" class="mono">C</a>,
    <a href="javascript:playBeat(4);" class="mono">D</a>,
    <a href="javascript:playBeat(5);" class="mono">E</a>,
    <a href="javascript:playBeat(6);" class="mono">F</a>,
    <a href="javascript:playBeat(7);" class="mono">G</a>,
    <a href="javascript:playBeat(8);" class="mono">H</a>,
    <a href="javascript:playBeat(9);" class="mono">I</a> para los distintos <i>golpes</i>.
  </p>
  <div>
    <label for="presets">Aquí tienes algunos ritmos de ejemplo:</label>
    <select id="presets">
      <option value="" disabled selected>-- Selecciona un patrón rítmico --</option>

      <option value="C00C00CH00C0CBB0">Clave de Son (16)</option>
      <option value="C0C0BB0C0C0BB0B0">Samba (16)</option>
      <option value="A0C0C0A0C0C0">Vals (12)</option>
      <option value="AC0BICBC0B0C">Son jarocho (12)</option>

      <option value="" disabled selected>-- Ritmos Latinos según IA (12x2) --</option>
      <option value="C0AC0A0B00C0 E0AF0A0B00E0">Son Montuno Extendido</option>
      <option value="0C00CFD0B000 00E0CFD0B000">Rumba Guaguancó</option>
      <option value="GB0AGB0AGB0A GB0AGB0AGB0A">Mozambique Contundente</option>
      <option value="C00B0AD000C0 00DB0AE000C0">Bomba Compleja</option>
      <option value="0D0GI00D0000 0D0GI00DE0A0">Samba Reggae Evolutivo</option>

      <option value="" disabled selected>-- Ritmos Latinos según IA (16x2) --</option>
      <option value="00C00A00C0000B00 00C00A00C000DB00">Salsa Dura (clásica)</option>
      <option value="C000C000A0B00000 E0AF0A000000B000">Guaguancó con Sabor</option>
      <option value="000GI0D0000000000 000GI0D0000E0A000">Merengue con Golpe</option>
      <option value="00C0B00000C0B000 00C0B0D000C00A000">Plena con Alegría</option>
      <option value="0A00B000C000D000 0A00B000C000D0E0">Cumbia Moderna (Electrónica)</option>
      <option value="0000C0000000C0A0 B0000000C000C000">Dembow Minimalista</option>
      <option value="C00C000A000C00C0 0000B0A00000C000">Timba con Descarga</option>

      <option value="" disabled selected>-- Ritmos Africanos según IA (12x2) --</option>
      <option value="00AG0000AG00 00AG0000AG00">Ritmo de Gnawa</option> 
      <option value="0000CD000000 CD000000CD00">Ritmo de Juju</option>
      <option value="C0A0C00B0000 C0A0C00B0000">Ritmo de Highlife</option>
      <option value="0A0B00C0A000 0A0B00C0D000">Ritmo de Kizomba</option>
      <option value="000GI0000000 00000IG00000">Ritmo de Afrobeat (Tónico)</option>
      <option value="C00C00C00C00 C0DC00C00C00">Ritmo de Mbalax</option>

             
      <option value="" disabled selected>-- Ritmos Africanos según IA --</option>
      <option value="00AG0000AG0000AG00 00AG0000AG0000AG00">Gnawa Expansivo</option>
      <option value="0000CD000000CD0000 0000CD000000CD0000">Juju Hipnótico</option>
      <option value="C0A0C00B0000C0A0 C00B0000C0A0C00B0">Highlife Envolvente</option>
      <option value="0A0B00C0A0000A0B 00C0A0000A0B00C00">Kizomba Seductor</option>
      <option value="000GI0000000000GI0 0000000000GI000000">Afrobeat Base Profunda</option>
      <option value="C00C00C00C00C00C C0DC00C00C00C0DC0">Mbalax Frenético</option>
      <option value="00AB000000AB0000 00AB00CD00AB00EF0">Ritmo Tribal Evolutivo</option>
      <option value="0000A0B0C000D000 0000A0B0C000D0000">Fusión Afro-Latina</option>

      <option value="" disabled selected>-- Ritmos Africanos Inventados por la IA --</option>
      <option value="0AG00AG000AG0AG000 0AG000AG0AG00AG00">Danza del Sol Naciente</option>
      <option value="C00B000C00B0A00B0 C000B00C00B00A0B">Canción del Bosque Sagrado</option>
      <option value="000E0F0000E0F000 0E0F000E00F000E">Latidos del Corazón de la Tierra</option>
      <option value="GBAGBAGBAGBAGBAGBA GBAGBAGBAGBAGBAGBA">Tambores de la Gran Migración</option>
      <option value="00CD0CD00CD000CD0 0CD0CD00CD000CD">Ritmo del Río Ancestral</option>
      <option value="HHHHIIHHIIIIHHIIII HHHHIIHHIIIIHHIIII">Danza del Fuego Ceremonial</option>
      <option value="00A00E0000A00E00 00A00E0000G00H00">Sinfonía de la Sabana</option>
      <option value="C000C000C000C000 D000D000D000D000">Llamada a los Espíritus</option>
      <option value="0A0B000C0D000E0F 0A0B000C0D000E0F">Viaje Interestelar Africano</option>
      <option value="0000EF000000EF00 0000EF000000EF00">Pulso del Cosmos Infinito</option>

    

    </select>
  </div>
  <p class="small">
    Puedes <button id="showReadme">VER EL README</button> del proyecto para tener más información.
  </p>
  0A0B00C0A0000A0B 00C0A0000A0B00C00
      
  
      

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
<script src="https://cdn.rawgit.com/showdownjs/showdown/1.9.1/dist/showdown.min.js"></script>

<script src="beats.js"></script>
<script src="metro.js"></script>

<script>
// Fetch README.md and convert it to HTML
fetch('README.md') 
.then(response => response.text())
.then(markdown => {
  let converter = new showdown.Converter();
  let html = converter.makeHtml(markdown);
  document.getElementById('readmeContent').innerHTML = html;
});

// Modal functionality
let readmodal = document.getElementById("readmeModal");
let btn = document.getElementById("showReadme");
let span = document.getElementsByClassName("close-button")[0];

btn.onclick = function() {
  readmodal.style.display = "block";
}

span.onclick = function() {
  readmodal.style.display = "none";
}

window.onclick = function(event) {
  if (event.target == readmodal) {
    readmodal.style.display = "none";
  }
}
</script>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js')
      .then(registration => {
        console.log('Service Worker registered:', registration);
        // Listen for updatefound event
        registration.addEventListener('updatefound', () => {
          const newWorker = registration.installing;

          newWorker.addEventListener('statechange', () => {
            if (newWorker.state === 'installed') {
              // Show update prompt
              if (confirm("Nueva versión disponible. ¿Actualizar ahora?")) {
                window.location.reload(); // Refresh for update
              }
            }
          });
        });
      })
      .catch(error => console.error('Service Worker registration failed:', error));
  });
}
</script>
</body>
</html>