<!DOCTYPE html>
<html lang="es-MX" xml:lang="es-MX">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Metrónomo">
  <meta name="image" content="https://sanxofon.github.io/metro/metro.jpg">
  <meta name="author" content="Santiago Chávez Novaro">
  <link rel="manifest" href="https://sanxofon.github.io/metro/manifest.json">
  <title>Metronomo</title>
  <meta name="theme-color" content="#222323" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Metrónomo">
  <meta name="apple-mobile-web-app-title" content="Metrónomo">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="og:title" content="Metrónomo">
  <meta name="og:description" content="Metrónomo irregular circular con sonidos reales, ligero y fácil de instalar en cualquier dispositivo desde el navegador.">
  <meta name="og:image" content="https://sanxofon.github.io/metro/metro.jpg">
  <meta name="og:url" content="https://sanxofon.github.io/metro/">
  <meta name="og:site_name" content="Sociedad Matemática Mexicana">
  <meta name="og:locale" content="es_MX">
  <meta name="og:type" content="website">
  <meta name="website:author" content="Santiago Chávez Novaro">
  <meta itemprop="name" content="Metrónomo">
  <meta itemprop="description" content="Metrónomo irregular circular con sonidos reales, ligero y fácil de instalar en cualquier dispositivo desde el navegador.">
  <meta itemprop="image" content="https://sanxofon.github.io/metro/metro.jpg">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Metrónomo">
  <meta name="twitter:description" content="Metrónomo irregular circular con sonidos reales, ligero y fácil de instalar en cualquier dispositivo desde el navegador.">
  <meta name="twitter:site" content="@grupolalengua">
  <meta name="twitter:creator" content="@sanxofon">
  <meta name="twitter:image:src" content="https://sanxofon.github.io/metro/metro.jpg">
  <meta name="format-detection" content="telephone=no">
  <link rel="icon" type="image/png" sizes="192x192" href="https://sanxofon.github.io/metro/icon-192x192.png">
  <link rel="apple-touch-icon" href="https://sanxofon.github.io/metro/icon-192x192.png">
  <link rel="shortcut icon" href="https://sanxofon.github.io/metro/favicon.png" type="image/png">
  <link rel="icon" href="https://sanxofon.github.io/metro/favicon.png" type="image/png">

  <link rel="stylesheet" href="metro.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
</head>
<body>
<div class="metronome">

  <div id="readmeModal" class="readmodal">
    <div class="readmodal-content">
      <span class="close-button">×</span>
      <div id="readmeContent"></div>
    </div>
  </div>

  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <span class="close">×</span>
      <h2>⏳ Historial</h2>
      <div><select id="historial" name="historial" size="8"></select></div>
      <div><a href="#" id="vaciarHistorial">Vaciar historial de patrones</a></div>
    </div>
  </div>

  <div class="recuadro reloj">

    <!-- DARK/LIGHT MODE SWITCH -->
    <div class="switch-div">
      <label class="switch" title="Modo Oscuro/Claro">
        <input type="checkbox" id="darkModeSwitch">
        <span class="slider round"></span>
      </label>
    </div>
  
    <!-- SETTINGS -->
    <div class="settings-icon" title="Configuración">
      ⏳ <!-- Gear icon entity -->
    </div>

    <!-- CÍRCULO -->
    <div class="clock">
      <div class="hand hour-hand"></div>
    </div>

    <!-- PATRÓN -->
    <div class="recuadro">
      <div id="patternLen" title="Longitud del patrón"></div>
      <div>
        <input type="text" id="beatPattern" placeholder="Ingrese un patrón rítmico (e.g., 1020)" value="">
      </div>
    </div>
    
    <!-- BOTONES -->
    <div>
      <button id="startButton">&#9658;</button>
      
      <div class="recuadro beat-counter">0</div>
      <button id="stopButton">&#9724;</button>
    </div>
    
    <br>

  </div>

  <!-- PATRÓN -->
  <div class="recuadro">
    <div class="numberContainer">
      <div class="grid" id="numberGrid" title="Silenciar / Desilenciar"><div id="mute-icon" title="Silenciar / Desilenciar todos">&#128263;</div></div>
    </div>
  </div>
  
  <!-- HERRAMIENTAS -->
  <div class="recuadro">
    <div>
      <select title="Beats o Compases por minuto" id="BPM-CPM">
        <option value="0" title="Beats Por Minuto">BPM</option>
        <option value="1" title="Compases Por Minuto">CPM</option>
      </select>
      <input type="number" id="bpmInput" value="120" min="1" max="1000">
    </div>
    <div>
      <label for="volumen">Velocidad</label>
      <input type="range" id="bpmSlider" min="1" max="1000" value="120" style="vertical-align: middle;">
    </div>
    <div>
      <label for="volumen">Volumen</label>
      <input type="range" name="volumen" id="volumen" min="0" max="1" step="0.01" value="1" style="vertical-align: middle;">
    </div>
  </div>

  <h1>  
      Metrónomo
  </h1>

  <p>
    Selecciona la velocidad de los <i>beats</i> (BPM) o de <i>compás</i> (CPM) y escribe un patrón rítmico, puedes hacer <i>silencios</i> con <b class="mono">0</b> (cero) y usar <a href="javascript:playBeat(1);" class="mono">A</a>,
    <a href="javascript:playBeat(2);" class="mono">B</a>,
    <a href="javascript:playBeat(3);" class="mono">C</a>,
    <a href="javascript:playBeat(4);" class="mono">D</a>,
    <a href="javascript:playBeat(5);" class="mono">E</a>,
    <a href="javascript:playBeat(6);" class="mono">F</a>,
    <a href="javascript:playBeat(7);" class="mono">G</a>,
    <a href="javascript:playBeat(8);" class="mono">H</a>,
    <a href="javascript:playBeat(9);" class="mono">I</a> para los distintos <i>golpes</i>.
  </p>
  <div>
    <label for="presets">Aquí tienes algunos ritmos de ejemplo:</label>
    <select id="presets">
      <option value="" disabled selected>-- Selecciona --</option>
      <option value="C00C00CH00C0CBB0">Clave de Son (16)</option>
      <option value="C0C0BB0C0C0BB0B0">Samba (16)</option>
      <option value="A0C0C0A0C0C0">Vals (12)</option>
      <option value="AC0BICBC0B0C">Son jarocho (12)</option>
    </select>
  </div>
  <p class="small">
    Puedes <button id="showReadme">VER EL README</button> del proyecto para tener más información.
  </p>

      
  
      

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
<script src="https://cdn.rawgit.com/showdownjs/showdown/1.9.1/dist/showdown.min.js"></script>

<script src="beats.js"></script>
<script src="metro.js"></script>

<script>
// Fetch README.md and convert it to HTML
fetch('README.md') 
.then(response => response.text())
.then(markdown => {
  let converter = new showdown.Converter();
  let html = converter.makeHtml(markdown);
  document.getElementById('readmeContent').innerHTML = html;
});

// Modal functionality
let readmodal = document.getElementById("readmeModal");
let btn = document.getElementById("showReadme");
let span = document.getElementsByClassName("close-button")[0];

btn.onclick = function() {
  readmodal.style.display = "block";
}

span.onclick = function() {
  readmodal.style.display = "none";
}

window.onclick = function(event) {
  if (event.target == readmodal) {
    readmodal.style.display = "none";
  }
}
</script>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js')
      .then(registration => {
        console.log('Service Worker registered:', registration);
        // Listen for updatefound event
        registration.addEventListener('updatefound', () => {
          const newWorker = registration.installing;

          newWorker.addEventListener('statechange', () => {
            if (newWorker.state === 'installed') {
              // Show update prompt
              if (confirm("Nueva versión disponible. ¿Actualizar ahora?")) {
                window.location.reload(); // Refresh for update
              }
            }
          });
        });
      })
      .catch(error => console.error('Service Worker registration failed:', error));
  });
}
</script>
</body>
</html>